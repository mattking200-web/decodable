<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Decodable Story Builder</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #eef4ff;
  text-align: center;
  padding: 20px;
}
#story {
  font-size: 26px;
  margin: 20px;
}
#picture {
  font-size: 120px;
  margin: 20px;
}
button {
  padding: 12px 20px;
  font-size: 16px;
  margin: 10px;
}
.correct { color: green; }
.incorrect { color: red; }
</style>
</head>
<body>

<h1>Decodable Book Builder</h1>

<div id="picture"></div>
<div id="story"></div>

<button onclick="startListening()">üé§ Read Story</button>
<button onclick="newStory()">üìñ New Story</button>

<div id="feedback"></div>

<script>

// Word bank grouped by meaning
const nouns = [
  {word:"cat", emoji:"üê±"},
  {word:"dog", emoji:"üê∂"},
  {word:"pig", emoji:"üê∑"},
  {word:"sun", emoji:"‚òÄÔ∏è"},
  {word:"bug", emoji:"üêû"},
  {word:"hat", emoji:"üé©"},
  {word:"cup", emoji:"‚òï"},
  {word:"bed", emoji:"üõèÔ∏è"}
];

const verbs = ["run","sit","hop","dig","nap"];
const places = ["mat","box","mud","rug","hill"];

let missedWord = null;
let currentStory = "";
let targetWords = [];

function generateStory() {

  let noun = nouns[Math.floor(Math.random()*nouns.length)];
  let verb = verbs[Math.floor(Math.random()*verbs.length)];
  let place = places[Math.floor(Math.random()*places.length)];

  // If child missed a word, reuse it
  if (missedWord) {
    noun = nouns.find(n => n.word === missedWord) || noun;
  }

  currentStory = `The ${noun.word} can ${verb}. The ${noun.word} is on the ${place}.`;

  targetWords = [noun.word, verb, place];

  document.getElementById("story").innerText = currentStory;
  document.getElementById("picture").innerText = noun.emoji;
  document.getElementById("feedback").innerHTML = "";
}

generateStory();

// Speech Recognition
function startListening() {

  const recognition = new(window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-US";
  recognition.start();

  recognition.onresult = function(event) {
    const spoken = event.results[0][0].transcript.toLowerCase();
    checkReading(spoken);
  };
}

function checkReading(spokenText) {

  const spokenWords = spokenText.split(" ");
  let feedbackHTML = "";
  missedWord = null;

  targetWords.forEach(word => {

    if (!spokenWords.includes(word)) {
      feedbackHTML += `<div class="incorrect">${word} ‚ùå</div>`;
      missedWord = word;
      soundOut(word);
    } else {
      feedbackHTML += `<div class="correct">${word} ‚úÖ</div>`;
    }

  });

  document.getElementById("feedback").innerHTML = feedbackHTML;
}

function soundOut(word) {

  let phonics = word.split("").join(" - ");
  let utter = new SpeechSynthesisUtterance(phonics + "... " + word);
  utter.rate = 0.8;
  speechSynthesis.speak(utter);
}

function newStory() {
  generateStory();
}

</script>

</body>
</html>
